# Signal Platform - Cloudflare Workers Configuration
name = "signal-api"
main = "workers/api/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Account configuration (set via environment or wrangler login)
# account_id = "your-account-id"

[vars]
ENVIRONMENT = "production"

# D1 Database binding
[[d1_databases]]
binding = "DB"
database_name = "signal-feedback-db"
database_id = "your-database-id"  # Replace after creating: wrangler d1 create signal-feedback-db

# Vectorize Index binding
[[vectorize]]
binding = "VECTORIZE"
index_name = "signal-embeddings"

# Queue bindings
[[queues.producers]]
binding = "FEEDBACK_QUEUE"
queue = "signal-feedback-queue"

[[queues.consumers]]
queue = "signal-feedback-queue"
max_batch_size = 10
max_batch_timeout = 30

# AI binding
[ai]
binding = "AI"

# KV Namespace for caching (optional)
# [[kv_namespaces]]
# binding = "CACHE"
# id = "your-kv-namespace-id"

# Environment-specific configuration
[env.staging]
name = "signal-api-staging"
vars = { ENVIRONMENT = "staging" }

[env.production]
name = "signal-api"
vars = { ENVIRONMENT = "production" }

# Routes (for custom domains)
# routes = [
#   { pattern = "signal-api.yourdomain.com/*", zone_name = "yourdomain.com" }
# ]

# Triggers (scheduled tasks)
[triggers]
crons = [
  "0 * * * *",   # Run alert detection every hour
  "0 0 * * *",   # Run daily digest at midnight
  "0 0 * * 0"    # Run weekly report on Sundays
]

# Build configuration
[build]
command = "npm run build"

[build.upload]
format = "modules"
main = "./dist/index.js"

[[send_email]]
name = "ALERT_EMAIL"
destination_address = "shubhjha.pm@gmail.com"  